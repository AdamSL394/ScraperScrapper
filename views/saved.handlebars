<style>
    .hide {
        display: none;
    }

    .note-wrap {
        width: 50vw;
       
        background: rgba(255, 255, 255, .8);
        min-height: 100vh;
        text-align: center;
        padding-top: 5%;
        z-index: 999;
        float:right;
    }

    .note-form {
        color: white;
    }
</style>

<div class="note-wrap hide" data-nid="" data-aid="">
    <form class="note-form">
        <br />
        <input type="text" id="title" required>

        <textarea type="text" class="body" required></textarea>
        <button class="update-note">Save</button>
        <button class="canel-note">Cancel</button>
    </form>
</div>

{{> header home=false saved=true}}





{{#each articles}}
{{#if saved}}

<div class="article-wrap" data-aid="{{this._id}}">
    <p>{{this.text}}</p>
    <a href="{{this.link}}">Article Link</a>
    <button class="unsave-btn" data-aid="{{this._id}}"> Unsave </button>
    {{#unless note}}
        <button class="add-btn" data-aid="{{this._id}}">add a note</button>
    {{else}}
    <div class="note-wrap" data-nid="{{this.note._id}}">
        <p class="note-title">{{this.note.title}}</p>
        <p class="note-body">{{this.note.body}}</p>
        <button class="update-btn">Update</button>
        <button class="delete-note">Delete</button>
    </div>
    {{/unless}}
</div>


{{/if }}
{{/each }}

{{!-- <div class="note-wrap hide" data-nid="" data-aid="">
    <form class="note-form">
        <input type="text" id="title">
        <textarea id="body"></textarea>
        <button class="update-note">Save</button>
        <button class="canel-note">Cancel</button>
    </form>
</div> --}}


{{#unless articles}}
<h2>Nosaved Articles</h2>
<a href="/">Go Home </a>
{{/unless}}

<script>

    $(".unsave-btn").on("click", function () {
        console.log("hi")
        var articleId = $(this).data("aid");
        var updateArticle = {
            saved: false
        }
        var self = $(this)
        $.ajax({
            method: "PUT",
            url: "/articles/" + articleId,
            data: updateArticle,
            sucess: function (result) {
                var parentElm = self.parent(".article-wrap")
                parentElm.remove();
            }

        })
    })

    $(".add-btn").on("click", function () {
        var articleId = $(this).data("aid")
        $(".note-wrap").attr("data-aid", articleId);
        $(".note-wrap").slideDown("slow");
    })

    $(".canel-note").on("click", function (e) {
        e.preventDefault();
        clearForm();
    })
    function clearForm() {
        $(".note-wrap").attr("data-aid", "");
        $(".note-wrap").slideUp("slow");
        $("#title, .body").val("");
    }

    $(".update-note").on("click", function (e) {

        $(".note-form")[0].reportValidity();
        e.preventDefault();
        var articleId = $(this).parents(".note-wrap").data("aid")

        var note = {
            title: $("#title").val().trim(),
            body: $(".body").val().trim()
        }
        clearForm();
        console.log(note);
        $.post("/article/"+ articleId +"/note",note, function (res) {
           console.log("this is the response client side", res)
        })
    })

    $(document).on("click", "p", function () {
        var idTag = $(this).parent(".article-wrap").data("aid")
        var nameTag = $(this).text()

        console.log(idTag);
        console.log(nameTag);
        $.ajax({
            method: "GET",
            url: "/notes/" + idTag
        }).then(function (data) {
            console.log(data)
            $(".note-wrap").empty();
            $()
        })    
    });
</script>